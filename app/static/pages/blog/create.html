<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Blog Post | ResumeAI Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <meta name="description" content="Create and publish blog posts for ResumeAI" />
  
  <link rel="stylesheet" href="/static/css/login.css" />
  <link rel="stylesheet" href="/static/css/navbar.css" />
  <link rel="stylesheet" href="/static/css/blog.css" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230a66c2%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22central%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-weight=%22900%22 font-size=%2250%22 fill=%22white%22>AI</text></svg>">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <nav class="navbar">
    <div class="container nav-container">

      <a href="/" class="logo-container" aria-label="ResumeAI Home">
        <span class="logo-text">Resume</span>
        <span class="logo-badge">AI</span>
      </a>

      <button class="hamburger" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <div class="nav-links">
        <a href="/builder">Builder</a>
        <a href="/blog">Blog</a>
        <a href="/admin/create-blog">Create Blog</a>
        <a href="/pricing">Pricing</a>

        <div id="nav-auth-section">
          <div class="g_id_signin" data-type="standard" data-size="medium" data-theme="filled_blue" data-text="signin"
            data-shape="rectangular" data-logo_alignment="left">
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="admin-container" id="admin-content">
    <div class="admin-header">
      <h1>Create Blog Post</h1>
      <p>Write and publish engaging content for your audience</p>
    </div>

    <div id="message-container"></div>

    <div class="blog-form">
      <form id="blog-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="title">Blog Title *</label>
            <input type="text" id="title" name="title" required placeholder="Enter an engaging title">
          </div>
          
          <div class="form-group">
            <label for="slug">URL Slug *</label>
            <input type="text" id="slug" name="slug" required placeholder="url-friendly-title">
            <small style="color: #666;">This will be used in the URL: /blog/your-slug</small>
          </div>
          
          <div class="form-group">
            <label for="category">Category *</label>
            <select id="category" name="category" required>
              <option value="">Select a category</option>
              <option value="Resume Writing">Resume Writing</option>
              <option value="Cover Letter">Cover Letter</option>
              <option value="ATS Optimization">ATS Optimization</option>
              <option value="Interview Tips">Interview Tips</option>
              <option value="Software Engineering">Software Engineering</option>
              <option value="AI & Technology">AI & Technology</option>
              <option value="Career Advice">Career Advice</option>
              <option value="Job Search">Job Search</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="read_time_minutes">Reading Time (minutes) *</label>
            <input type="number" id="read_time_minutes" name="read_time_minutes" required min="1" max="60" value="5">
          </div>
          
          <div class="form-group">
            <label for="author_name">Author Name</label>
            <input type="text" id="author_name" name="author_name" value="ResumeAI Team" placeholder="Author name">
          </div>
          
          <div class="form-group">
            <label for="featured_image">Featured Image URL</label>
            <input type="url" id="featured_image" name="featured_image" placeholder="https://example.com/image.jpg">
            <small style="color: #666;">Optional: Add a high-quality image for your blog post</small>
          </div>
          
          <div class="form-group full-width">
            <label for="excerpt">Excerpt/Summary</label>
            <textarea id="excerpt" name="excerpt" rows="3" placeholder="Brief summary of your blog post (2-3 sentences)"></textarea>
            <div class="char-counter"><span id="excerpt-count">0</span> / 300 characters</div>
          </div>
          
          <div class="form-group full-width">
            <label for="meta_description">Meta Description (SEO)</label>
            <textarea id="meta_description" name="meta_description" rows="2" placeholder="SEO meta description (150-160 characters)"></textarea>
            <div class="char-counter"><span id="meta-count">0</span> / 160 characters</div>
          </div>
          
          <div class="form-group full-width">
            <label for="tags">Tags</label>
            <input type="text" id="tags" name="tags" placeholder="resume, career advice, job search">
            <small style="color: #666;">Comma-separated tags for categorization</small>
          </div>
          
          <div class="form-group full-width">
            <label for="content">Blog Content *</label>
            <textarea id="content" name="content" required placeholder="Write your amazing blog content here..."></textarea>
            <div class="char-counter"><span id="content-count">0</span> characters</div>
            <small style="color: #666;">You can use Markdown formatting: # for headers, * for italics, ** for bold, etc.</small>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="previewBlog()">Preview</button>
          <button type="button" class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
          <button type="submit" class="btn btn-primary">Publish Blog Post</button>
        </div>
      </form>
    </div>

    <div class="preview-section">
      <div class="preview-header">
        <h2>Preview</h2>
        <span id="preview-status">Start writing to see preview</span>
      </div>
      <div id="preview-content" class="preview-content">
        <div class="empty-preview">
          <h3>No content yet</h3>
          <p>Start writing your blog post to see a live preview here</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer-container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ResumeAI</h3>
          <p>AI-powered resume and cover letter generation from job descriptions.</p>
        </div>
        <div class="footer-section">
          <h4>Product</h4>
          <ul>
            <li><a href="/builder">Resume Builder</a></li>
            <li><a href="/blog">Career Blog</a></li>
            <li><a href="/pricing">Pricing</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Resources</h4>
          <ul>
            <li><a href="/privacy-policy">Privacy Policy</a></li>
            <li><a href="/extra/contact">Contact</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2026 ResumeAI. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="/static/js/common.js"></script>
  <script>
    // Check authentication on page load
    document.addEventListener('DOMContentLoaded', function() {
      setupFormHandlers();
      updateAuthUI();
    });

    function setupFormHandlers() {
      // Auto-generate slug from title
      document.getElementById('title').addEventListener('input', function() {
        const title = this.value;
        const slug = title.toLowerCase()
          .replace(/[^a-z0-9\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .trim('-');
        document.getElementById('slug').value = slug;
        updatePreview();
      });

      // Character counters
      document.getElementById('excerpt').addEventListener('input', function() {
        document.getElementById('excerpt-count').textContent = this.value.length;
        updatePreview();
      });

      document.getElementById('meta_description').addEventListener('input', function() {
        document.getElementById('meta-count').textContent = this.value.length;
      });

      document.getElementById('content').addEventListener('input', function() {
        document.getElementById('content-count').textContent = this.value.length;
        updatePreview();
      });

      // Update preview on any input change
      document.querySelectorAll('#blog-form input, #blog-form textarea, #blog-form select').forEach(element => {
        element.addEventListener('input', updatePreview);
        element.addEventListener('change', updatePreview);
      });

      // Form submission
      document.getElementById('blog-form').addEventListener('submit', handleFormSubmit);
    }

    function updatePreview() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const excerpt = document.getElementById('excerpt').value;
      const category = document.getElementById('category').value;
      const author = document.getElementById('author_name').value;
      const readTime = document.getElementById('read_time_minutes').value;
      
      const previewContent = document.getElementById('preview-content');
      const previewStatus = document.getElementById('preview-status');
      
      if (!title && !content) {
        previewContent.innerHTML = `
          <div class="empty-preview">
            <h3>No content yet</h3>
            <p>Start writing your blog post to see a live preview here</p>
          </div>
        `;
        previewStatus.textContent = 'Start writing to see preview';
        return;
      }
      
      previewStatus.textContent = 'Live preview';
      
      // Simple markdown parsing
      let formattedContent = content
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
      
      if (formattedContent) {
        formattedContent = '<p>' + formattedContent + '</p>';
      }
      
      previewContent.innerHTML = `
        ${category ? `<div style="background: #0a66c2; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; display: inline-block; margin-bottom: 20px;">${category}</div>` : ''}
        ${title ? `<h1 style="color: #1a1a1a; margin-bottom: 20px;">${title}</h1>` : ''}
        <div style="display: flex; gap: 20px; margin-bottom: 30px; font-size: 0.9rem; color: #666;">
          ${author ? `<span><strong>${author}</strong></span>` : ''}
          <span>â€¢</span>
          <span>${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
          <span>â€¢</span>
          <span>${readTime || 5} min read</span>
        </div>
        ${excerpt ? `<p style="font-size: 1.1rem; color: #666; font-style: italic; margin-bottom: 30px;">${excerpt}</p>` : ''}
        <div style="font-size: 1.1rem; line-height: 1.8; color: #333;">
          ${formattedContent || '<p style="color: #999;">Start writing to see your content here...</p>'}
        </div>
      `;
    }

    function previewBlog() {
      updatePreview();
      document.querySelector('.preview-section').scrollIntoView({ behavior: 'smooth' });
    }

    function showMessage(message, type = 'success') {
      if (type === 'success') {
        showToast(message, 'success');
      } else {
        showToast(message, 'error');
      }
    }

    async function saveDraft() {
      showMessage('Draft saved locally (feature coming soon)', 'success');
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      // Convert published to boolean
      data.published = true;
      
      // Validation
      if (!data.title || !data.slug || !data.content || !data.category) {
        showMessage('Please fill in all required fields', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="loading"></span>Publishing...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch('/api/blog/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showMessage('Blog post published successfully! ðŸŽ‰', 'success');
          e.target.reset();
          updatePreview();
          
          // Redirect to blog after 2 seconds
          setTimeout(() => {
            window.location.href = '/blog';
          }, 2000);
        } else {
          const error = await response.json();
          showMessage(`Error: ${error.detail || 'Failed to publish blog post'}`, 'error');
        }
      } catch (error) {
        console.error('Error publishing blog post:', error);
        showMessage('Error publishing blog post. Please try again.', 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }
  </script>
</body>

</html>
